# DESCRIPTION: 	
# Builds and tests projects in the repository

name: $(SourceBranchName)-$(Date:yyyyMMdd)$(Rev:-r)
trigger:
  branches:
    include:
      - main
  paths:
    include:
      - src/FhirLoader.BulkImport
pr:
  branches:
    include:
      - main
  paths:
    include:
      - src/FhirLoader.BulkImport

parameters:
  - name: targetBuildFramework
    type: string
    default: 'net6.0'

variables:
  - template: ./variables/FhirLoader-BulkImport-Variables.yml

stages:
  - stage: Build

    jobs:
    - job: CodeChecks
      pool:
        vmImage: ${{ variables.WindowsVmImage }}
      steps:
      - template: ./jobs/checkCode.yml
        parameters:
          DotNetVersion: ${{ variables.DotNetVersion }}
          SolutionName: ${{ variables.SolutionName }}

    - job: BuildTestPublish
      pool:
        vmImage: ${{ variables.WindowsVmImage }}
      steps:
      - template: ./jobs/update-semver.yml
      - template: ./jobs/build.yml
        parameters:
          RunUnitTest: false
          RunComponentGovernance: false
      - template: ./jobs/publish.yml

#  - stage: 
#    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))
#    jobs:
#      - job: B1