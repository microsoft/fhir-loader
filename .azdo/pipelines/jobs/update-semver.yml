steps:
  - task: UseDotNet@2
    inputs:
      version: $(DotNetVersion)

  - powershell: |
      dotnet tool install --global GitVersion.Tool

      $gitVersionString = Invoke-Expression 'dotnet-gitversion /output json /config $(GitVersionFilePath)'

      Write-Host '----------Output from GitVersion----------'
      Write-Host $gitVersionString

      $gitVersionJson = $gitVersionString | ConvertFrom-Json

      Write-Host '----------GitVersion Converted JSON ----------'
      Write-Host $gitVersionJson

      Write-Host "##vso[task.setvariable variable=SemVer;isOutput=true]$($gitVersionJson.SemVer)"
      Write-Host "##vso[task.setvariable variable=InformationalVersion;isOutput=true]$($gitVersionJson.InformationalVersion)"
      Write-Host "##vso[task.setvariable variable=MajorMinorPatch;isOutput=true]$($gitVersionJson.MajorMinorPatch)"
      Write-Host "##vso[task.setvariable variable=NuGetVersion;isOutput=true]$($gitVersionJson.SemVer)"
      Write-Host "##vso[task.setvariable variable=AssemblySemVer;isOutput=true]$($gitVersionJson.AssemblySemVer)"
      Write-Host "##vso[task.setvariable variable=AssemblySemFileVer;isOutput=true]$($gitVersionJson.AssemblySemFileVer)"
      Write-Host "##vso[Build.UpdateBuildNumber]$($gitVersionJson.SemVer)"
    name: SetVariablesFromGitVersion

  - powershell: |
      Write-Host '----------Variables to use for build----------'
      Write-Host 'semVer: $(SetVariablesFromGitVersion.SemVer)'
      Write-Host 'majorMinorPatch: $(SetVariablesFromGitVersion.MajorMinorPatch)'
      Write-Host 'assemblySemVer: $(SetVariablesFromGitVersion.AssemblySemVer)'
      Write-Host 'assemblySemFileVer: $(SetVariablesFromGitVersion.AssemblySemFileVer)'
      Write-Host 'informationalVersion: $(SetVariablesFromGitVersion.InformationalVersion)'
    name: PrintVariablesFromGitVersion
